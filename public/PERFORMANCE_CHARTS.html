<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Analysis - Interactive Charts</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- Authentication Script -->
    <script src="/auth-utils.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .filter-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .filter-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #667eea;
        }

        .filter-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-btn {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            outline: none;
        }

        .filter-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .filter-label {
            font-size: 1em;
            color: #666;
            font-weight: 600;
            margin-right: 10px;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .chart-title {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .chart-subtitle {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 20px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        canvas {
            max-height: 400px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-change {
            font-size: 0.85em;
            margin-top: 8px;
            font-weight: 600;
        }

        .positive {
            color: #10b981;
        }

        .negative {
            color: #ef4444;
        }

        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <!-- User Profile & Logout (populated by auth-utils.js) -->
    <div style="position: fixed; top: 20px; right: 20px; z-index: 1000; background: white; padding: 12px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        <div id="user-profile-container"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ðŸ“Š Platform Performance Analysis Dashboard</h1>
            <p id="headerSubtitle">Comprehensive 3-Year Analysis (2023-2025)</p>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-title">ðŸ“… Year Filter</div>
            <div class="filter-buttons">
                <span class="filter-label">View Data For:</span>
                <button class="filter-btn active" data-year="all" onclick="filterByYear('all')">All Years (2023-2025)</button>
                <button class="filter-btn" data-year="2023" onclick="filterByYear(2023)">2023 Only</button>
                <button class="filter-btn" data-year="2024" onclick="filterByYear(2024)">2024 Only</button>
                <button class="filter-btn" data-year="2025" onclick="filterByYear(2025)">2025 Only</button>
            </div>
        </div>

        <!-- Key Stats -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-value" id="statOrders">3.5M</div>
                <div class="stat-label">Total Orders</div>
                <div class="stat-change positive" id="statOrdersChange">+16.0% Total Growth</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statMerchants">1,498</div>
                <div class="stat-label">Active Merchants</div>
                <div class="stat-change positive" id="statMerchantsChange">+25.7% since 2023</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statCompletion">91.2%</div>
                <div class="stat-label">Avg Completion Rate</div>
                <div class="stat-change negative" id="statCompletionChange">-0.81% decline</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statGrowth">2.8%</div>
                <div class="stat-label">YoY Growth</div>
                <div class="stat-change negative" id="statGrowthChange">-78% deceleration</div>
            </div>
        </div>

        <!-- Charts -->
        <div class="chart-grid">
            <!-- Chart 1: Monthly Orders -->
            <div class="chart-container full-width">
                <div class="chart-title" id="monthlyTitle">Monthly Order Volume (2023-2025)</div>
                <div class="chart-subtitle">Seasonal patterns and trends</div>
                <canvas id="monthlyOrdersChart"></canvas>
            </div>

            <!-- Chart 2: Quarterly Performance -->
            <div class="chart-container">
                <div class="chart-title" id="quarterlyTitle">Quarterly Performance</div>
                <div class="chart-subtitle">Quarter-by-quarter comparison</div>
                <canvas id="quarterlyChart"></canvas>
            </div>

            <!-- Chart 3: Monthly Completion Rates -->
            <div class="chart-container">
                <div class="chart-title" id="completionTitle">Monthly Completion Rates</div>
                <div class="chart-subtitle">Operational efficiency trends</div>
                <canvas id="monthlyCompletionChart"></canvas>
            </div>

            <!-- Chart 4: Orders vs Trips -->
            <div class="chart-container">
                <div class="chart-title">Orders & Delivery Trips</div>
                <div class="chart-subtitle">Volume comparison</div>
                <canvas id="ordersTripsChart"></canvas>
            </div>

            <!-- Chart 5: Completion Breakdown -->
            <div class="chart-container">
                <div class="chart-title">Delivery Status Breakdown</div>
                <div class="chart-subtitle">Completed vs Canceled trips</div>
                <canvas id="statusBreakdownChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Chart.js default configuration
        Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif';
        Chart.defaults.plugins.legend.display = true;
        Chart.defaults.plugins.legend.position = 'top';

        // Color palette
        const colors = {
            primary: '#667eea',
            secondary: '#764ba2',
            success: '#10b981',
            danger: '#ef4444',
            warning: '#f59e0b',
            info: '#06b6d4',
            year2023: '#8b5cf6',
            year2024: '#06b6d4',
            year2025: '#f59e0b',
        };

        // Data storage
        const yearData = {
            2023: {
                orders: 1068649,
                trips: 968778,
                completed: 888852,
                canceled: 79922,
                completionRate: 91.75,
                merchants: 1192,
                monthly: [73559, 72137, 91712, 98834, 84751, 93163, 85234, 86063, 89106, 93337, 100373, 100380],
                monthlyTrips: [68152, 65944, 77928, 83276, 77058, 83948, 78320, 79658, 83169, 86225, 92158, 92942],
                monthlyCompleted: [62919, 60094, 68274, 73231, 70859, 76663, 72678, 74006, 77008, 80155, 85933, 87032],
                monthlyCompletion: [92.32, 91.13, 87.61, 87.94, 91.96, 91.32, 92.80, 92.90, 92.59, 92.96, 93.25, 93.64],
                quarterly: [237408, 276748, 260403, 294090],
            },
            2024: {
                orders: 1205610,
                trips: 1056352,
                completed: 961323,
                canceled: 95029,
                completionRate: 91.00,
                merchants: 1461,
                monthly: [86791, 88818, 111101, 99669, 107947, 105229, 99185, 95666, 97638, 107789, 99861, 105916],
                monthlyTrips: [80271, 80664, 91963, 83617, 93727, 89147, 83680, 85806, 85556, 95086, 91264, 95571],
                monthlyCompleted: [75196, 74463, 81548, 75794, 85562, 80694, 75908, 78478, 77116, 86027, 83368, 87169],
                monthlyCompletion: [93.68, 92.31, 88.67, 90.64, 91.29, 90.52, 90.71, 91.46, 90.14, 90.47, 91.35, 91.21],
                quarterly: [286710, 312845, 292489, 313566],
            },
            2025: {
                orders: 1239381,
                trips: 1078998,
                completed: 981252,
                canceled: 97746,
                completionRate: 90.94,
                merchants: 1498,
                monthly: [99021, 97151, 120552, 95223, 109928, 110770, 102426, 107405, 106888, 104346, 89842, 95829],
                monthlyTrips: [90619, 87412, 95585, 85530, 98537, 96701, 92458, 92656, 90282, 90139, 77832, 81247],
                monthlyCompleted: [83809, 79730, 83001, 77506, 89553, 87306, 85139, 86371, 83030, 81754, 70368, 73685],
                monthlyCompletion: [92.49, 91.21, 86.83, 90.62, 90.88, 90.28, 92.08, 93.22, 91.97, 90.70, 90.41, 90.69],
                quarterly: [316724, 315921, 316719, 290017],
            }
        };

        let currentYear = 'all';
        let allCharts = {};

        // Filter function
        function filterByYear(year) {
            currentYear = year;

            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-year="${year}"]`).classList.add('active');

            // Update header subtitle
            if (year === 'all') {
                document.getElementById('headerSubtitle').textContent = 'Comprehensive 3-Year Analysis (2023-2025)';
            } else {
                document.getElementById('headerSubtitle').textContent = `Year ${year} Performance Analysis`;
            }

            // Update stats
            updateStats(year);

            // Update all charts
            updateAllCharts(year);
        }

        function updateStats(year) {
            if (year === 'all') {
                document.getElementById('statOrders').textContent = '3.5M';
                document.getElementById('statOrdersChange').textContent = '+16.0% Total Growth';
                document.getElementById('statOrdersChange').className = 'stat-change positive';

                document.getElementById('statMerchants').textContent = '1,498';
                document.getElementById('statMerchantsChange').textContent = '+25.7% since 2023';
                document.getElementById('statMerchantsChange').className = 'stat-change positive';

                document.getElementById('statCompletion').textContent = '91.2%';
                document.getElementById('statCompletionChange').textContent = '-0.81% decline';
                document.getElementById('statCompletionChange').className = 'stat-change negative';

                document.getElementById('statGrowth').textContent = '2.8%';
                document.getElementById('statGrowthChange').textContent = '-78% deceleration';
                document.getElementById('statGrowthChange').className = 'stat-change negative';
            } else {
                const data = yearData[year];
                const prevYear = year - 1;

                document.getElementById('statOrders').textContent = (data.orders / 1000000).toFixed(2) + 'M';

                if (yearData[prevYear]) {
                    const growth = ((data.orders - yearData[prevYear].orders) / yearData[prevYear].orders * 100).toFixed(2);
                    document.getElementById('statOrdersChange').textContent = `${growth > 0 ? '+' : ''}${growth}% vs ${prevYear}`;
                    document.getElementById('statOrdersChange').className = growth >= 0 ? 'stat-change positive' : 'stat-change negative';
                } else {
                    document.getElementById('statOrdersChange').textContent = 'Baseline Year';
                    document.getElementById('statOrdersChange').className = 'stat-change';
                }

                document.getElementById('statMerchants').textContent = data.merchants.toLocaleString();
                if (yearData[prevYear]) {
                    const merchantGrowth = ((data.merchants - yearData[prevYear].merchants) / yearData[prevYear].merchants * 100).toFixed(1);
                    document.getElementById('statMerchantsChange').textContent = `${merchantGrowth > 0 ? '+' : ''}${merchantGrowth}% vs ${prevYear}`;
                    document.getElementById('statMerchantsChange').className = merchantGrowth >= 0 ? 'stat-change positive' : 'stat-change negative';
                } else {
                    document.getElementById('statMerchantsChange').textContent = 'Baseline Year';
                    document.getElementById('statMerchantsChange').className = 'stat-change';
                }

                document.getElementById('statCompletion').textContent = data.completionRate.toFixed(2) + '%';
                if (yearData[prevYear]) {
                    const completionChange = (data.completionRate - yearData[prevYear].completionRate).toFixed(2);
                    document.getElementById('statCompletionChange').textContent = `${completionChange > 0 ? '+' : ''}${completionChange}% vs ${prevYear}`;
                    document.getElementById('statCompletionChange').className = completionChange >= 0 ? 'stat-change positive' : 'stat-change negative';
                } else {
                    document.getElementById('statCompletionChange').textContent = 'Baseline Year';
                    document.getElementById('statCompletionChange').className = 'stat-change';
                }

                if (yearData[prevYear]) {
                    const yoyGrowth = ((data.orders - yearData[prevYear].orders) / yearData[prevYear].orders * 100).toFixed(2);
                    document.getElementById('statGrowth').textContent = yoyGrowth + '%';
                    document.getElementById('statGrowthChange').textContent = `YoY Growth vs ${prevYear}`;
                    document.getElementById('statGrowthChange').className = yoyGrowth >= 0 ? 'stat-change positive' : 'stat-change negative';
                } else {
                    document.getElementById('statGrowth').textContent = 'N/A';
                    document.getElementById('statGrowthChange').textContent = 'Baseline Year';
                    document.getElementById('statGrowthChange').className = 'stat-change';
                }
            }
        }

        function updateAllCharts(year) {
            updateMonthlyOrdersChart(year);
            updateQuarterlyChart(year);
            updateMonthlyCompletionChart(year);
            updateOrdersTripsChart(year);
            updateStatusBreakdownChart(year);
        }

        function updateMonthlyOrdersChart(year) {
            if (allCharts.monthlyOrders) {
                allCharts.monthlyOrders.destroy();
            }

            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            let datasets = [];

            if (year === 'all') {
                document.getElementById('monthlyTitle').textContent = 'Monthly Order Volume (2023-2025)';
                datasets = [
                    {
                        label: '2023',
                        data: yearData[2023].monthly,
                        borderColor: colors.year2023,
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: false,
                    },
                    {
                        label: '2024',
                        data: yearData[2024].monthly,
                        borderColor: colors.year2024,
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: false,
                    },
                    {
                        label: '2025',
                        data: yearData[2025].monthly,
                        borderColor: colors.year2025,
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: false,
                    }
                ];
            } else {
                document.getElementById('monthlyTitle').textContent = `Monthly Order Volume (${year})`;
                const yearColor = year === 2023 ? colors.year2023 : year === 2024 ? colors.year2024 : colors.year2025;
                datasets = [{
                    label: `${year} Orders`,
                    data: yearData[year].monthly,
                    borderColor: yearColor,
                    backgroundColor: `${yearColor}33`,
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 5,
                    pointHoverRadius: 7,
                }];
            }

            allCharts.monthlyOrders = new Chart(document.getElementById('monthlyOrdersChart'), {
                type: 'line',
                data: {
                    labels: months,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000).toFixed(0) + 'K';
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateQuarterlyChart(year) {
            if (allCharts.quarterly) {
                allCharts.quarterly.destroy();
            }

            const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
            let datasets = [];

            if (year === 'all') {
                document.getElementById('quarterlyTitle').textContent = 'Quarterly Performance (2023-2025)';
                datasets = [
                    {
                        label: '2023',
                        data: yearData[2023].quarterly,
                        backgroundColor: colors.year2023,
                    },
                    {
                        label: '2024',
                        data: yearData[2024].quarterly,
                        backgroundColor: colors.year2024,
                    },
                    {
                        label: '2025',
                        data: yearData[2025].quarterly,
                        backgroundColor: colors.year2025,
                    }
                ];
            } else {
                document.getElementById('quarterlyTitle').textContent = `Quarterly Performance (${year})`;
                const yearColor = year === 2023 ? colors.year2023 : year === 2024 ? colors.year2024 : colors.year2025;
                datasets = [{
                    label: `${year} Orders`,
                    data: yearData[year].quarterly,
                    backgroundColor: [
                        `${yearColor}dd`,
                        `${yearColor}bb`,
                        `${yearColor}99`,
                        `${yearColor}77`,
                    ],
                }];
            }

            allCharts.quarterly = new Chart(document.getElementById('quarterlyChart'), {
                type: 'bar',
                data: {
                    labels: quarters,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000).toFixed(0) + 'K';
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateMonthlyCompletionChart(year) {
            if (allCharts.monthlyCompletion) {
                allCharts.monthlyCompletion.destroy();
            }

            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            let datasets = [];

            if (year === 'all') {
                document.getElementById('completionTitle').textContent = 'Monthly Completion Rates (2023-2025)';
                datasets = [
                    {
                        label: '2023',
                        data: yearData[2023].monthlyCompletion,
                        borderColor: colors.year2023,
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: false,
                    },
                    {
                        label: '2024',
                        data: yearData[2024].monthlyCompletion,
                        borderColor: colors.year2024,
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: false,
                    },
                    {
                        label: '2025',
                        data: yearData[2025].monthlyCompletion,
                        borderColor: colors.year2025,
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: false,
                    },
                    {
                        label: 'Target (95%)',
                        data: [95, 95, 95, 95, 95, 95, 95, 95, 95, 95, 95, 95],
                        borderColor: colors.success,
                        borderWidth: 2,
                        borderDash: [10, 5],
                        fill: false,
                        pointRadius: 0,
                    }
                ];
            } else {
                document.getElementById('completionTitle').textContent = `Monthly Completion Rates (${year})`;
                const yearColor = year === 2023 ? colors.year2023 : year === 2024 ? colors.year2024 : colors.year2025;
                datasets = [
                    {
                        label: `${year} Completion %`,
                        data: yearData[year].monthlyCompletion,
                        borderColor: yearColor,
                        backgroundColor: `${yearColor}33`,
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                    },
                    {
                        label: 'Target (95%)',
                        data: [95, 95, 95, 95, 95, 95, 95, 95, 95, 95, 95, 95],
                        borderColor: colors.success,
                        borderWidth: 2,
                        borderDash: [10, 5],
                        fill: false,
                        pointRadius: 0,
                    }
                ];
            }

            allCharts.monthlyCompletion = new Chart(document.getElementById('monthlyCompletionChart'), {
                type: 'line',
                data: {
                    labels: months,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            min: 85,
                            max: 96,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateOrdersTripsChart(year) {
            if (allCharts.ordersTrips) {
                allCharts.ordersTrips.destroy();
            }

            let labels, ordersData, tripsData;

            if (year === 'all') {
                labels = ['2023', '2024', '2025'];
                ordersData = [yearData[2023].orders, yearData[2024].orders, yearData[2025].orders];
                tripsData = [yearData[2023].trips, yearData[2024].trips, yearData[2025].trips];
            } else {
                labels = ['Q1', 'Q2', 'Q3', 'Q4'];
                ordersData = yearData[year].quarterly;
                tripsData = yearData[year].quarterly.map((q, i) => {
                    const monthStart = i * 3;
                    const monthEnd = monthStart + 3;
                    return yearData[year].monthlyTrips.slice(monthStart, monthEnd).reduce((a, b) => a + b, 0);
                });
            }

            allCharts.ordersTrips = new Chart(document.getElementById('ordersTripsChart'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Orders',
                        data: ordersData,
                        backgroundColor: colors.primary,
                    }, {
                        label: 'Delivery Trips',
                        data: tripsData,
                        backgroundColor: colors.info,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000).toFixed(0) + 'K';
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateStatusBreakdownChart(year) {
            if (allCharts.statusBreakdown) {
                allCharts.statusBreakdown.destroy();
            }

            let completedData, canceledData;

            if (year === 'all') {
                completedData = [yearData[2023].completed, yearData[2024].completed, yearData[2025].completed];
                canceledData = [yearData[2023].canceled, yearData[2024].canceled, yearData[2025].canceled];
            } else {
                const data = yearData[year];
                completedData = [data.completed];
                canceledData = [data.canceled];
            }

            allCharts.statusBreakdown = new Chart(document.getElementById('statusBreakdownChart'), {
                type: 'pie',
                data: {
                    labels: ['Completed', 'Canceled'],
                    datasets: [{
                        data: year === 'all'
                            ? [
                                yearData[2023].completed + yearData[2024].completed + yearData[2025].completed,
                                yearData[2023].canceled + yearData[2024].canceled + yearData[2025].canceled
                            ]
                            : [yearData[year].completed, yearData[year].canceled],
                        backgroundColor: [colors.success, colors.danger],
                        borderWidth: 2,
                        borderColor: '#fff',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(2);
                                    return `${label}: ${value.toLocaleString()} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Initialize charts with all years
        updateAllCharts('all');
    </script>
</body>
</html>
