<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orders & Delivery Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #60a5fa 100%);
            padding: 20px;
            color: #1e3a8a;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .filter-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .filter-row {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .filter-group {
            flex: 1;
            min-width: 250px;
        }

        .filter-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2563eb;
            border-bottom: 3px solid #2563eb;
            padding-bottom: 10px;
        }

        .filter-label {
            font-size: 0.95em;
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 8px;
            display: block;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #3b82f6;
            background: white;
            color: #2563eb;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
            outline: none;
        }

        .filter-btn:hover {
            background: #3b82f6;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .filter-btn.active {
            background: #2563eb;
            color: white;
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4);
        }

        select.filter-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: border 0.3s;
            background: white;
            color: #1e40af;
        }

        select.filter-select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 4px solid #3b82f6;
        }

        .stat-card.highlight {
            border-top: 4px solid #10b981;
            background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%);
        }

        .stat-card.warning {
            border-top: 4px solid #ef4444;
            background: linear-gradient(135deg, #ffffff 0%, #fef2f2 100%);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #2563eb;
            margin-bottom: 5px;
        }

        .stat-value.success {
            color: #10b981;
        }

        .stat-value.danger {
            color: #ef4444;
        }

        .stat-label {
            font-size: 0.9em;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-change {
            font-size: 0.85em;
            margin-top: 8px;
            font-weight: 600;
        }

        .positive {
            color: #10b981;
        }

        .negative {
            color: #ef4444;
        }

        .neutral {
            color: #64748b;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .chart-title {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #1e40af;
            border-bottom: 3px solid #3b82f6;
            padding-bottom: 10px;
        }

        .chart-subtitle {
            font-size: 0.9em;
            color: #64748b;
            margin-bottom: 20px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        canvas {
            max-height: 400px;
        }

        .insight-box {
            background: linear-gradient(135deg, #dbeafe 0%, #eff6ff 100%);
            border-left: 4px solid #2563eb;
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
        }

        .insight-box h4 {
            color: #1e40af;
            font-size: 1em;
            margin-bottom: 8px;
        }

        .insight-box p {
            color: #475569;
            font-size: 0.9em;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .filter-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì¶ Orders & Delivery Analytics Dashboard</h1>
            <p id="headerSubtitle">Operational Performance Analysis (2023-2025)</p>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-title">üîç Analysis Filters</div>

            <div class="filter-row">
                <!-- Year Filter -->
                <div class="filter-group">
                    <label class="filter-label">üìÖ Time Period</label>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="year" data-value="all" onclick="updateFilter('year', 'all')">All Years</button>
                        <button class="filter-btn" data-filter="year" data-value="2023" onclick="updateFilter('year', 2023)">2023</button>
                        <button class="filter-btn" data-filter="year" data-value="2024" onclick="updateFilter('year', 2024)">2024</button>
                        <button class="filter-btn" data-filter="year" data-value="2025" onclick="updateFilter('year', 2025)">2025</button>
                    </div>
                </div>

                <!-- Quarter Filter -->
                <div class="filter-group">
                    <label class="filter-label">üìä Quarter</label>
                    <select class="filter-select" id="quarterFilter" onchange="updateFilter('quarter', this.value)">
                        <option value="all">All Quarters</option>
                        <option value="Q1">Q1 (Jan-Mar)</option>
                        <option value="Q2">Q2 (Apr-Jun)</option>
                        <option value="Q3">Q3 (Jul-Sep)</option>
                        <option value="Q4">Q4 (Oct-Dec)</option>
                    </select>
                </div>

                <!-- Status Filter -->
                <div class="filter-group">
                    <label class="filter-label">‚úÖ Delivery Status</label>
                    <select class="filter-select" id="statusFilter" onchange="updateFilter('status', this.value)">
                        <option value="all">All Statuses</option>
                        <option value="completed">Completed Only</option>
                        <option value="canceled">Canceled Only</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Key Stats -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-value" id="statOrders">3.51M</div>
                <div class="stat-label">Total Orders</div>
                <div class="stat-change positive" id="statOrdersChange">+8.1% YoY Growth</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statTrips">3.05M</div>
                <div class="stat-label">Delivery Trips</div>
                <div class="stat-change neutral" id="statTripsChange">86.9% conversion</div>
            </div>
            <div class="stat-card highlight">
                <div class="stat-value success" id="statCompleted">2.77M</div>
                <div class="stat-label">Completed</div>
                <div class="stat-change positive" id="statCompletedChange">90.9% success rate</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-value danger" id="statCanceled">275K</div>
                <div class="stat-label">Canceled</div>
                <div class="stat-change negative" id="statCanceledChange">9.0% failure rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statAvgDaily">3,212</div>
                <div class="stat-label">Avg Daily Orders</div>
                <div class="stat-change" id="statAvgDailyChange">Per operational day</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statGrowthRate">+8.1%</div>
                <div class="stat-label">YoY Growth Rate</div>
                <div class="stat-change positive" id="statGrowthChange">2024 ‚Üí 2025</div>
            </div>
        </div>

        <!-- Charts -->
        <div class="chart-grid">
            <!-- Chart 1: Annual Performance Trend -->
            <div class="chart-container full-width">
                <div class="chart-title">Annual Performance Trend</div>
                <div class="chart-subtitle">Year-over-year comparison of orders, trips, and completions</div>
                <canvas id="annualTrendChart"></canvas>
                <div class="insight-box">
                    <h4>üìà Key Insight</h4>
                    <p id="annualInsight">Growth deceleration observed: 12.82% (2024) ‚Üí 2.80% (2025). Focus needed on merchant retention and acquisition.</p>
                </div>
            </div>

            <!-- Chart 2: Monthly Order Volume -->
            <div class="chart-container full-width">
                <div class="chart-title">Monthly Order Volume Trends</div>
                <div class="chart-subtitle">3-year monthly comparison with YoY growth patterns</div>
                <canvas id="monthlyVolumeChart"></canvas>
                <div class="insight-box">
                    <h4>üìä Key Insight</h4>
                    <p id="monthlyInsight">March consistently peaks (avg 107K orders). Q4 2025 shows -10% decline - investigate merchant churn impact.</p>
                </div>
            </div>

            <!-- Chart 3: Quarterly Performance -->
            <div class="chart-container">
                <div class="chart-title">Quarterly Performance Breakdown</div>
                <div class="chart-subtitle">Orders and completion rates by quarter</div>
                <canvas id="quarterlyChart"></canvas>
            </div>

            <!-- Chart 4: Completion Rate Trends -->
            <div class="chart-container">
                <div class="chart-title">Completion Rate Trends</div>
                <div class="chart-subtitle">Monthly completion rate vs 95% target</div>
                <canvas id="completionTrendChart"></canvas>
            </div>

            <!-- Chart 5: Order-to-Trip Conversion -->
            <div class="chart-container">
                <div class="chart-title">Order-to-Trip Conversion Rate</div>
                <div class="chart-subtitle">Efficiency of order processing to actual deliveries</div>
                <canvas id="conversionChart"></canvas>
                <div class="insight-box">
                    <h4>‚ö° Key Insight</h4>
                    <p id="conversionInsight">Stable 86.9% conversion rate. Remaining 13.1% includes cancellations, consolidations, and batch processing.</p>
                </div>
            </div>

            <!-- Chart 6: Status Distribution -->
            <div class="chart-container">
                <div class="chart-title">Delivery Status Distribution</div>
                <div class="chart-subtitle">Completed vs canceled breakdown by year</div>
                <canvas id="statusChart"></canvas>
            </div>

            <!-- Chart 7: Best & Worst Months -->
            <div class="chart-container">
                <div class="chart-title">Top 10 Performing Months</div>
                <div class="chart-subtitle">Highest order volume months (2023-2025)</div>
                <canvas id="topMonthsChart"></canvas>
            </div>

            <!-- Chart 8: Growth Rate Analysis -->
            <div class="chart-container">
                <div class="chart-title">Month-over-Month Growth Rate</div>
                <div class="chart-subtitle">MoM percentage change in order volume</div>
                <canvas id="growthRateChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Chart.js configuration
        Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif';

        // Blue and white color palette
        const colors = {
            primary: '#2563eb',
            secondary: '#3b82f6',
            light: '#60a5fa',
            lighter: '#93c5fd',
            lightest: '#dbeafe',
            dark: '#1e40af',
            darker: '#1e3a8a',
            success: '#10b981',
            danger: '#ef4444',
            warning: '#f59e0b',
            info: '#06b6d4',
        };

        // Comprehensive data structure
        const ordersData = {
            annual: {
                2023: {
                    orders: 1068649,
                    trips: 968778,
                    completed: 888852,
                    canceled: 79926,
                    completionRate: 91.75,
                    growth: null
                },
                2024: {
                    orders: 1205610,
                    trips: 1054352,
                    completed: 962323,
                    canceled: 92029,
                    completionRate: 91.27,
                    growth: 12.82
                },
                2025: {
                    orders: 1239381,
                    trips: 1078998,
                    completed: 981142,
                    canceled: 97856,
                    completionRate: 90.94,
                    growth: 2.80
                }
            },

            monthly: {
                2023: [
                    { month: 'Jan', orders: 73559, trips: 68152, completed: 62919, completion: 92.32, yoy: null, mom: null },
                    { month: 'Feb', orders: 72137, trips: 65944, completed: 60094, completion: 91.13, yoy: null, mom: -1.93 },
                    { month: 'Mar', orders: 91712, trips: 77928, completed: 68274, completion: 87.61, yoy: null, mom: 27.14 },
                    { month: 'Apr', orders: 98834, trips: 83276, completed: 73231, completion: 87.94, yoy: null, mom: 7.77 },
                    { month: 'May', orders: 84751, trips: 77058, completed: 70859, completion: 91.96, yoy: null, mom: -14.25 },
                    { month: 'Jun', orders: 93163, trips: 83948, completed: 76663, completion: 91.32, yoy: null, mom: 9.93 },
                    { month: 'Jul', orders: 85234, trips: 78320, completed: 72678, completion: 92.80, yoy: null, mom: -8.51 },
                    { month: 'Aug', orders: 86063, trips: 79658, completed: 74006, completion: 92.90, yoy: null, mom: 0.97 },
                    { month: 'Sep', orders: 89106, trips: 83169, completed: 77008, completion: 92.59, yoy: null, mom: 3.54 },
                    { month: 'Oct', orders: 93337, trips: 86225, completed: 80155, completion: 92.96, yoy: null, mom: 4.75 },
                    { month: 'Nov', orders: 100373, trips: 92158, completed: 85933, completion: 93.25, yoy: null, mom: 7.54 },
                    { month: 'Dec', orders: 100380, trips: 92942, completed: 87032, completion: 93.64, yoy: null, mom: 0.01 }
                ],
                2024: [
                    { month: 'Jan', orders: 86791, trips: 80271, completed: 75196, completion: 93.68, yoy: 17.99, mom: -13.54 },
                    { month: 'Feb', orders: 88818, trips: 80664, completed: 74463, completion: 92.31, yoy: 23.12, mom: 2.34 },
                    { month: 'Mar', orders: 111101, trips: 91963, completed: 81548, completion: 88.67, yoy: 21.14, mom: 25.09 },
                    { month: 'Apr', orders: 99669, trips: 83617, completed: 75794, completion: 90.64, yoy: 0.84, mom: -10.29 },
                    { month: 'May', orders: 107947, trips: 93727, completed: 85562, completion: 91.29, yoy: 27.37, mom: 8.31 },
                    { month: 'Jun', orders: 105229, trips: 89147, completed: 80694, completion: 90.52, yoy: 12.95, mom: -2.52 },
                    { month: 'Jul', orders: 99185, trips: 83680, completed: 75908, completion: 90.71, yoy: 16.37, mom: -5.74 },
                    { month: 'Aug', orders: 95666, trips: 85806, completed: 78478, completion: 91.46, yoy: 11.16, mom: -3.55 },
                    { month: 'Sep', orders: 97638, trips: 85556, completed: 77116, completion: 90.14, yoy: 9.58, mom: 2.06 },
                    { month: 'Oct', orders: 107789, trips: 95086, completed: 86027, completion: 90.47, yoy: 15.48, mom: 10.40 },
                    { month: 'Nov', orders: 99861, trips: 91264, completed: 83368, completion: 91.35, yoy: -0.51, mom: -7.36 },
                    { month: 'Dec', orders: 105916, trips: 95571, completed: 87169, completion: 91.21, yoy: 5.52, mom: 6.06 }
                ],
                2025: [
                    { month: 'Jan', orders: 99021, trips: 90619, completed: 83809, completion: 92.49, yoy: 14.09, mom: -6.51 },
                    { month: 'Feb', orders: 97151, trips: 87412, completed: 79730, completion: 91.21, yoy: 9.38, mom: -1.89 },
                    { month: 'Mar', orders: 120552, trips: 95585, completed: 83001, completion: 86.83, yoy: 8.51, mom: 24.09 },
                    { month: 'Apr', orders: 95223, trips: 85530, completed: 77506, completion: 90.62, yoy: -4.46, mom: -21.01 },
                    { month: 'May', orders: 109928, trips: 98537, completed: 89553, completion: 90.88, yoy: 1.84, mom: 15.44 },
                    { month: 'Jun', orders: 110770, trips: 96701, completed: 87306, completion: 90.28, yoy: 5.27, mom: 0.77 },
                    { month: 'Jul', orders: 102426, trips: 92458, completed: 85139, completion: 92.08, yoy: 3.27, mom: -7.53 },
                    { month: 'Aug', orders: 107405, trips: 92656, completed: 86371, completion: 93.22, yoy: 12.27, mom: 4.86 },
                    { month: 'Sep', orders: 106888, trips: 90282, completed: 83030, completion: 91.97, yoy: 9.47, mom: -0.48 },
                    { month: 'Oct', orders: 104346, trips: 90139, completed: 81754, completion: 90.70, yoy: -3.19, mom: -2.38 },
                    { month: 'Nov', orders: 89842, trips: 77832, completed: 70368, completion: 90.41, yoy: -10.03, mom: -13.90 },
                    { month: 'Dec', orders: 95829, trips: 81247, completed: 73685, completion: 90.69, yoy: -9.52, mom: 6.66 }
                ]
            },

            quarterly: {
                2023: [
                    { quarter: 'Q1', orders: 237408, trips: 212024, completion: 90.22 },
                    { quarter: 'Q2', orders: 276748, trips: 244282, completion: 90.37 },
                    { quarter: 'Q3', orders: 260403, trips: 241147, completion: 92.76 },
                    { quarter: 'Q4', orders: 294090, trips: 271325, completion: 93.29 }
                ],
                2024: [
                    { quarter: 'Q1', orders: 286710, trips: 252898, completion: 91.42 },
                    { quarter: 'Q2', orders: 312845, trips: 266491, completion: 90.83 },
                    { quarter: 'Q3', orders: 292489, trips: 255042, completion: 90.77 },
                    { quarter: 'Q4', orders: 313566, trips: 281921, completion: 91.01 }
                ],
                2025: [
                    { quarter: 'Q1', orders: 316724, trips: 273616, completion: 90.10 },
                    { quarter: 'Q2', orders: 315921, trips: 280768, completion: 90.60 },
                    { quarter: 'Q3', orders: 316719, trips: 275396, completion: 92.43 },
                    { quarter: 'Q4', orders: 290017, trips: 249218, completion: 90.61 }
                ]
            }
        };

        let currentFilters = {
            year: 'all',
            quarter: 'all',
            status: 'all'
        };

        let allCharts = {};

        // Filter update function
        function updateFilter(type, value) {
            currentFilters[type] = value;

            // Update button states for year filter
            if (type === 'year') {
                document.querySelectorAll('[data-filter="year"]').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-filter="year"][data-value="${value}"]`).classList.add('active');
            }

            // Update header subtitle
            updateHeader();

            // Update stats
            updateStats();

            // Update all charts
            updateAllCharts();
        }

        function updateHeader() {
            const { year, quarter, status } = currentFilters;
            let subtitle = 'Operational Performance Analysis (2023-2025)';

            if (year !== 'all' || quarter !== 'all' || status !== 'all') {
                subtitle = 'Filtered View: ';
                const parts = [];
                if (year !== 'all') parts.push(`Year ${year}`);
                if (quarter !== 'all') parts.push(quarter);
                if (status !== 'all') parts.push(`${status.charAt(0).toUpperCase() + status.slice(1)} Only`);
                subtitle += parts.join(' | ');
            }

            document.getElementById('headerSubtitle').textContent = subtitle;
        }

        function updateStats() {
            const { year, quarter, status } = currentFilters;
            let totalOrders = 0;
            let totalTrips = 0;
            let totalCompleted = 0;
            let totalCanceled = 0;
            let completionRate = 0;
            let growth = 0;

            // Calculate based on filters
            if (year === 'all') {
                totalOrders = 3513640;
                totalTrips = 3102128;
                totalCompleted = 2832317;
                totalCanceled = 269811;
                completionRate = 90.94;
                growth = 8.1;
            } else {
                const yearData = ordersData.annual[year];
                totalOrders = yearData.orders;
                totalTrips = yearData.trips;
                totalCompleted = yearData.completed;
                totalCanceled = yearData.canceled;
                completionRate = yearData.completionRate;
                growth = yearData.growth || 0;

                // Apply quarter filter
                if (quarter !== 'all') {
                    const qIndex = parseInt(quarter.charAt(1)) - 1;
                    const qData = ordersData.quarterly[year][qIndex];
                    totalOrders = qData.orders;
                    totalTrips = qData.trips;
                    completionRate = qData.completion;
                    totalCompleted = Math.round(totalTrips * (completionRate / 100));
                    totalCanceled = totalTrips - totalCompleted;
                }
            }

            // Apply status filter
            if (status === 'completed') {
                totalOrders = totalCompleted;
                totalCanceled = 0;
            } else if (status === 'canceled') {
                totalOrders = totalCanceled;
                totalCompleted = 0;
            }

            // Update display
            const avgDaily = Math.round(totalOrders / 365);

            if (totalOrders >= 1000000) {
                document.getElementById('statOrders').textContent = (totalOrders / 1000000).toFixed(2) + 'M';
            } else {
                document.getElementById('statOrders').textContent = (totalOrders / 1000).toFixed(0) + 'K';
            }

            if (totalTrips >= 1000000) {
                document.getElementById('statTrips').textContent = (totalTrips / 1000000).toFixed(2) + 'M';
            } else {
                document.getElementById('statTrips').textContent = (totalTrips / 1000).toFixed(0) + 'K';
            }

            if (totalCompleted >= 1000000) {
                document.getElementById('statCompleted').textContent = (totalCompleted / 1000000).toFixed(2) + 'M';
            } else {
                document.getElementById('statCompleted').textContent = (totalCompleted / 1000).toFixed(0) + 'K';
            }

            if (totalCanceled >= 1000000) {
                document.getElementById('statCanceled').textContent = (totalCanceled / 1000000).toFixed(2) + 'M';
            } else {
                document.getElementById('statCanceled').textContent = (totalCanceled / 1000).toFixed(0) + 'K';
            }

            document.getElementById('statAvgDaily').textContent = avgDaily.toLocaleString();
            document.getElementById('statGrowthRate').textContent = (growth >= 0 ? '+' : '') + growth.toFixed(1) + '%';
            document.getElementById('statCompletedChange').textContent = completionRate.toFixed(1) + '% success rate';

            const failureRate = 100 - completionRate;
            document.getElementById('statCanceledChange').textContent = failureRate.toFixed(1) + '% failure rate';

            const conversionRate = (totalTrips / totalOrders * 100).toFixed(1);
            document.getElementById('statTripsChange').textContent = conversionRate + '% conversion';
        }

        function updateAllCharts() {
            updateAnnualTrendChart();
            updateMonthlyVolumeChart();
            updateQuarterlyChart();
            updateCompletionTrendChart();
            updateConversionChart();
            updateStatusChart();
            updateTopMonthsChart();
            updateGrowthRateChart();
        }

        function updateAnnualTrendChart() {
            if (allCharts.annualTrend) {
                allCharts.annualTrend.destroy();
            }

            const years = ['2023', '2024', '2025'];
            const orders = years.map(y => ordersData.annual[y].orders);
            const trips = years.map(y => ordersData.annual[y].trips);
            const completed = years.map(y => ordersData.annual[y].completed);

            allCharts.annualTrend = new Chart(document.getElementById('annualTrendChart'), {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Orders',
                        data: orders,
                        backgroundColor: colors.light,
                        borderColor: colors.light,
                        borderWidth: 2
                    }, {
                        label: 'Delivery Trips',
                        data: trips,
                        backgroundColor: colors.secondary,
                        borderColor: colors.secondary,
                        borderWidth: 2
                    }, {
                        label: 'Completed',
                        data: completed,
                        backgroundColor: colors.success,
                        borderColor: colors.success,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000000).toFixed(1) + 'M';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.parsed.y;
                                    return `${label}: ${(value / 1000000).toFixed(2)}M`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateMonthlyVolumeChart() {
            if (allCharts.monthlyVolume) {
                allCharts.monthlyVolume.destroy();
            }

            const { year } = currentFilters;
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

            let datasets = [];

            if (year === 'all') {
                datasets = [
                    {
                        label: '2023',
                        data: ordersData.monthly[2023].map(m => m.orders),
                        borderColor: colors.lighter,
                        backgroundColor: 'rgba(147, 197, 253, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: '2024',
                        data: ordersData.monthly[2024].map(m => m.orders),
                        borderColor: colors.secondary,
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: '2025',
                        data: ordersData.monthly[2025].map(m => m.orders),
                        borderColor: colors.primary,
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }
                ];
            } else {
                datasets = [{
                    label: year,
                    data: ordersData.monthly[year].map(m => m.orders),
                    borderColor: colors.primary,
                    backgroundColor: 'rgba(37, 99, 235, 0.2)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 5,
                    pointHoverRadius: 7
                }];
            }

            allCharts.monthlyVolume = new Chart(document.getElementById('monthlyVolumeChart'), {
                type: 'line',
                data: {
                    labels: months,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000).toFixed(0) + 'K';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toLocaleString()} orders`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateQuarterlyChart() {
            if (allCharts.quarterly) {
                allCharts.quarterly.destroy();
            }

            const { year } = currentFilters;
            const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];

            let data, labels;

            if (year === 'all') {
                labels = ['2023 Q1', '2023 Q2', '2023 Q3', '2023 Q4',
                          '2024 Q1', '2024 Q2', '2024 Q3', '2024 Q4',
                          '2025 Q1', '2025 Q2', '2025 Q3', '2025 Q4'];
                data = [
                    ...ordersData.quarterly[2023].map(q => q.orders),
                    ...ordersData.quarterly[2024].map(q => q.orders),
                    ...ordersData.quarterly[2025].map(q => q.orders)
                ];
            } else {
                labels = quarters;
                data = ordersData.quarterly[year].map(q => q.orders);
            }

            allCharts.quarterly = new Chart(document.getElementById('quarterlyChart'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Orders',
                        data: data,
                        backgroundColor: colors.secondary,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000).toFixed(0) + 'K';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function updateCompletionTrendChart() {
            if (allCharts.completionTrend) {
                allCharts.completionTrend.destroy();
            }

            const { year } = currentFilters;
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

            let datasets = [];

            if (year === 'all') {
                datasets = [
                    {
                        label: '2023',
                        data: ordersData.monthly[2023].map(m => m.completion),
                        borderColor: colors.lighter,
                        borderWidth: 2,
                        tension: 0.4,
                        fill: false,
                        pointRadius: 3
                    },
                    {
                        label: '2024',
                        data: ordersData.monthly[2024].map(m => m.completion),
                        borderColor: colors.secondary,
                        borderWidth: 2,
                        tension: 0.4,
                        fill: false,
                        pointRadius: 3
                    },
                    {
                        label: '2025',
                        data: ordersData.monthly[2025].map(m => m.completion),
                        borderColor: colors.primary,
                        borderWidth: 3,
                        tension: 0.4,
                        fill: false,
                        pointRadius: 4
                    },
                    {
                        label: 'Target (95%)',
                        data: Array(12).fill(95),
                        borderColor: colors.success,
                        borderWidth: 2,
                        borderDash: [10, 5],
                        fill: false,
                        pointRadius: 0
                    }
                ];
            } else {
                datasets = [
                    {
                        label: `${year} Completion Rate`,
                        data: ordersData.monthly[year].map(m => m.completion),
                        borderColor: colors.primary,
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    },
                    {
                        label: 'Target (95%)',
                        data: Array(12).fill(95),
                        borderColor: colors.success,
                        borderWidth: 2,
                        borderDash: [10, 5],
                        fill: false,
                        pointRadius: 0
                    }
                ];
            }

            allCharts.completionTrend = new Chart(document.getElementById('completionTrendChart'), {
                type: 'line',
                data: {
                    labels: months,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            min: 80,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateConversionChart() {
            if (allCharts.conversion) {
                allCharts.conversion.destroy();
            }

            const years = ['2023', '2024', '2025'];
            const conversionRates = years.map(y => {
                const data = ordersData.annual[y];
                return (data.trips / data.orders * 100).toFixed(2);
            });

            allCharts.conversion = new Chart(document.getElementById('conversionChart'), {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Order-to-Trip Conversion %',
                        data: conversionRates,
                        backgroundColor: [colors.lighter, colors.secondary, colors.primary],
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            min: 80,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function updateStatusChart() {
            if (allCharts.status) {
                allCharts.status.destroy();
            }

            const years = ['2023', '2024', '2025'];
            const completed = years.map(y => ordersData.annual[y].completed);
            const canceled = years.map(y => ordersData.annual[y].canceled);

            allCharts.status = new Chart(document.getElementById('statusChart'), {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Completed',
                        data: completed,
                        backgroundColor: colors.success,
                    }, {
                        label: 'Canceled',
                        data: canceled,
                        backgroundColor: colors.danger,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            stacked: false,
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000000).toFixed(1) + 'M';
                                }
                            }
                        },
                        x: {
                            stacked: false
                        }
                    }
                }
            });
        }

        function updateTopMonthsChart() {
            if (allCharts.topMonths) {
                allCharts.topMonths.destroy();
            }

            // Collect all months from all years
            const allMonths = [];
            ['2023', '2024', '2025'].forEach(year => {
                ordersData.monthly[year].forEach((m, idx) => {
                    allMonths.push({
                        label: `${m.month} ${year}`,
                        orders: m.orders,
                        year: year
                    });
                });
            });

            // Sort by orders and take top 10
            const top10 = allMonths.sort((a, b) => b.orders - a.orders).slice(0, 10);

            const colors2023 = '#93c5fd';
            const colors2024 = '#3b82f6';
            const colors2025 = '#2563eb';

            const bgColors = top10.map(m => {
                if (m.year === '2023') return colors2023;
                if (m.year === '2024') return colors2024;
                return colors2025;
            });

            allCharts.topMonths = new Chart(document.getElementById('topMonthsChart'), {
                type: 'bar',
                data: {
                    labels: top10.map(m => m.label),
                    datasets: [{
                        label: 'Orders',
                        data: top10.map(m => m.orders),
                        backgroundColor: bgColors,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000).toFixed(0) + 'K';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function updateGrowthRateChart() {
            if (allCharts.growthRate) {
                allCharts.growthRate.destroy();
            }

            const { year } = currentFilters;
            const selectedYear = year === 'all' ? 2025 : year;
            const months = ordersData.monthly[selectedYear];
            const labels = months.map(m => m.month);
            const momData = months.map(m => m.mom || 0);

            const bgColors = momData.map(val => val >= 0 ? colors.success : colors.danger);

            allCharts.growthRate = new Chart(document.getElementById('growthRateChart'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'MoM Growth %',
                        data: momData,
                        backgroundColor: bgColors,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Initialize
        updateStats();
        updateAllCharts();
    </script>
</body>
</html>
